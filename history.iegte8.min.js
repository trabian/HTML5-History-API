(function(v){"function"===typeof define&&define.amd?define("object"!==typeof document||"loading"!==document.readyState?[]:"html5-history-api",v):v()})(function(){function v(){}function l(a,b,c){if(null==a||""===a||b){if(a=b?a:f.href,!n||c)a=a.replace(/^[^#]*/,"")||"#",a=f.protocol.replace(/:.*$|$/,":")+"//"+f.host+k.basepath+a.replace(new RegExp("^#[/]?(?:"+k.type+")?"),"")}else{b=l();var d=g.getElementsByTagName("base")[0];!c&&d&&d.getAttribute("href")&&(d.href=d.href,b=l(d.href,null,!0));c=b._pathname;
d=b._protocol;a=""+a;a=/^(?:\w+\:)?\/\//.test(a)?0===a.indexOf("/")?d+a:a:d+"//"+b._host+(0===a.indexOf("/")?a:0===a.indexOf("?")?c+a:0===a.indexOf("#")?c+b._search+a:c.replace(/[^\/]+$/g,"")+a)}J.href=a;a=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/.exec(J.href);b=a[2]+(a[3]?":"+a[3]:"");c=a[4]||"/";var d=a[5]||"",e="#"===a[6]?"":a[6]||"",K=c+d+e,h=c.replace(new RegExp("^"+k.basepath,"i"),k.type)+d;return{_href:a[1]+"//"+b+K,_protocol:a[1],_host:b,
_hostname:a[2],_port:a[3]||"",_pathname:c,_search:d,_hash:e,_relative:K,_nohash:h,_special:h+e}}function X(){var a;try{a=e.sessionStorage,a.setItem("__historyAPI__t","1"),a.removeItem("__historyAPI__t")}catch(b){a={getItem:function(a){a=g.cookie.split(a+"=");return 1<a.length&&a.pop().split(";").shift()||"null"},setItem:function(a,b){var c={};if(c[f.href]=h.state)g.cookie=a+"="+z.stringify(c)}}}try{m=z.parse(a.getItem("__historyAPI__"))||{}}catch(c){m={}}p(s+"unload",function(){a.setItem("__historyAPI__",
z.stringify(m))},!1)}function A(a,b,c,d){var f=0;c||(c={set:v},f=1);var g=!c.set,h=!c.get,k={configurable:!0,set:function(){g=1},get:function(){h=1}};try{w(a,b,k),a[b]=a[b],w(a,b,c)}catch(l){}if(!g||!h)if(a.__defineGetter__&&(a.__defineGetter__(b,k.get),a.__defineSetter__(b,k.set),a[b]=a[b],c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)),!g||!h){if(f)return!1;if(a===e){try{var n=a[b];a[b]=null}catch(q){}if("execScript"in e)e.execScript("Public "+b,"VBScript"),e.execScript("var "+
b+";","JavaScript");else try{w(a,b,{value:v})}catch(r){}a[b]=n}else try{try{var m=F.create(a);w(F.getPrototypeOf(m)===a?m:a,b,c);for(var p in a)"function"===typeof a[p]&&(m[p]=a[p].bind(a));try{d.call(m,m,a)}catch(s){}a=m}catch(t){w(a.constructor.prototype,b,c)}}catch(u){return!1}}return a}function Y(a,b,c){c=c||{};a=a===L?f:a;c.set=c.set||function(c){a[b]=c};c.get=c.get||function(){return a[b]};return c}function Z(a,b,c){a in t?t[a].push(b):3<arguments.length?p(a,b,c,arguments[3]):p(a,b,c)}function $(a,
b,c){var d=t[a];if(d)for(a=d.length;a--;){if(d[a]===b){d.splice(a,1);break}}else M(a,b,c)}function B(a,b){var c=(""+("string"===typeof a?a:a.type)).replace(/^on/,""),d=t[c];if(d){b="string"===typeof a?b:a;if(null==b.target)for(var f=["target","currentTarget","srcElement","type"];a=f.pop();)b=A(b,a,{get:"type"===a?function(){return c}:function(){return e}});(("popstate"===c?e.onpopstate:e.onhashchange)||v).call(e,b);for(var f=0,g=d.length;f<g;f++)d[f].call(e,b);return!0}return aa(a,b)}function N(){var a=
g.createEvent?g.createEvent("Event"):g.createEventObject();a.initEvent?a.initEvent("popstate",!1,!1):a.type="popstate";a.state=h.state;B(a)}function x(a,b,c,d){n?y=f.href:(0===q&&(q=2),b=l(b,2===q&&-1!==(""+b).indexOf("#")),b._relative!==l()._relative&&(y=d,c?f.replace("#"+b._special):f.hash=b._special));!C&&a&&(m[f.href]=a);D=!1}function O(a){var b=y;y=f.href;if(b){P!==f.href&&N();a=a||e.event;var b=l(b,!0),c=l();a.oldURL||(a.oldURL=b._href,a.newURL=c._href);b._hash!==c._hash&&B(a)}}function Q(a){setTimeout(function(){p("popstate",
function(a){P=f.href;C||(a=A(a,"state",{get:function(){return h.state}}));B(a)},!1)},0);!n&&!0!==a&&"location"in h&&(R(E.hash),D&&(D=!1,N()))}function ba(a){a=a||e.event;var b;a:{for(b=a.target||a.srcElement;b;){if("A"===b.nodeName)break a;b=b.parentNode}b=void 0}var c="defaultPrevented"in a?a.defaultPrevented:!1===a.returnValue;b&&"A"===b.nodeName&&!c&&(c=l(),b=l(b.getAttribute("href",2)),c._href.split("#").shift()===b._href.split("#").shift()&&b._hash&&(c._hash!==b._hash&&(E.hash=b._hash),R(b._hash),
a.preventDefault?a.preventDefault():a.returnValue=!1))}function R(a){var b=g.getElementById(a=(a||"").replace(/^#/,""));b&&b.id===a&&"A"===b.nodeName&&(a=b.getBoundingClientRect(),e.scrollTo(G.scrollLeft||0,a.top+(G.scrollTop||0)-(G.clientTop||0)))}var e=("object"===typeof window?window:this)||{};if(!e.history||"emulate"in e.history)return e.history;var g=e.document,G=g.documentElement,F=e.Object,z=e.JSON,f=e.location,r=e.history,h=r,H=r.pushState,S=r.replaceState,n=!!H,C="state"in r,w=F.defineProperty,
E=A({},"t")?{}:g.createElement("a"),s="",I=e.addEventListener?"addEventListener":(s="on","attachEvent"),T=e.removeEventListener?"removeEventListener":"detachEvent",U=e.dispatchEvent?"dispatchEvent":"fireEvent",p=e[I],M=e[T],aa=e[U],k={basepath:"/",redirect:0,type:"/"},J=g.createElement("a"),y=f.href,P="",D=!1,q=0,m={},t={},u=g.title,ca={onhashchange:null,onpopstate:null},V=function(a,b){var c=e.history!==r;c&&(e.history=r);a.apply(r,b);c&&(e.history=h)},W={setup:function(a,b,c){k.basepath=(""+(null==
a?k.basepath:a)).replace(/(?:^|\/)[^\/]*$/,"/");k.type=null==b?k.type:b;k.redirect=null==c?k.redirect:!!c},redirect:function(a,b,c){c=void 0===typeof c?!1:c;h.setup(b,a);b=k.basepath;if(e.top==e.self){a=l(null,!1,!0)._relative;var d=f.pathname+f.search;n?(d=d.replace(/([^\/])$/,"$1/"),a!=b&&(new RegExp("^"+b+"$","i")).test(d)&&f.replace(a)):d==b||c||(d=d.replace(/([^\/])\?/,"$1/?"),(new RegExp("^"+b,"i")).test(d)&&f.replace(b+"#"+d.replace(new RegExp("^"+b,"i"),k.type)+f.hash))}},pushState:function(a,
b,c){var d=g.title;null!=u&&(g.title=u);H&&V(H,arguments);x(a,c);g.title=d;u=b},replaceState:function(a,b,c){var d=g.title;null!=u&&(g.title=u);delete m[f.href];S&&V(S,arguments);x(a,c,!0);g.title=d;u=b},location:{set:function(a){0===q&&(q=1);e.location=a},get:function(){0===q&&(q=1);return n?f:E}},state:{get:function(){return m[f.href]||null}}},L={assign:function(a){0===(""+a).indexOf("#")?x(null,a):f.assign(a)},reload:function(){f.reload()},replace:function(a){0===(""+a).indexOf("#")?x(null,a,!0):
f.replace(a)},toString:function(){return this.href},href:{get:function(){return l()._href}},protocol:null,host:null,hostname:null,port:null,pathname:{get:function(){return l()._pathname}},search:{get:function(){return l()._search}},hash:{set:function(a){x(null,(""+a).replace(/^(#|)/,"#"),!1,y)},get:function(){return l()._hash}}};if(function(){var a=g.getElementsByTagName("script"),a=(a[a.length-1]||{}).src||"";(-1!==a.indexOf("?")?a.split("?").pop():"").replace(/(\w+)(?:=([^&]*))?/g,function(a,b,
c){k[b]=(c||"").replace(/^(0|false)$/,"")});p(s+"hashchange",O,!1);var b=[L,E,ca,e,W,h];C&&delete W.state;for(var c=0;c<b.length;c+=2)for(var d in b[c])if(b[c].hasOwnProperty(d))if("function"===typeof b[c][d])b[c+1][d]=b[c][d];else{a=Y(b[c],d,b[c][d]);if(!A(b[c+1],d,a,function(a,d){d===h&&(e.history=h=b[c+1]=a)}))return M(s+"hashchange",O,!1),!1;b[c+1]===e&&(t[d]=t[d.substr(2)]=[])}h.setup();k.redirect&&h.redirect();!C&&z&&X();if(!n)g[I](s+"click",ba,!1);"complete"===g.readyState?Q(!0):(n||l()._relative===
k.basepath||(D=!0),p(s+"load",Q,!1));return!0}())return h.emulate=!n,e[I]=Z,e[T]=$,e[U]=B,h});
